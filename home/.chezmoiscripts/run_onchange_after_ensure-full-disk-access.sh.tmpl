#!/bin/bash

# set -eufo pipefail
set           \
  -o errexit  \
  -o nounset  \
  -o noglob   \
  -o pipefail

{{ if (and (eq .chezmoi.os "darwin") (not .ephemeral)) -}}

# ensure this terminal has Full Disk Access
echo ""
echo "Checking Full Disk Access permissions..."

while ! ls /Library/Application\ Support/com.apple.TCC &>/dev/null; do
  echo ""
  echo "This terminal requires Full Disk Access permission."
  echo "Opening System Settings > Privacy & Security > Full Disk Access..."
  open "x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles"
  echo ""
  echo "Please enable Full Disk Access for this terminal,"
  echo "then press ENTER to continue..."
  read -r
done

echo "Full Disk Access permissions are configured."

{{- end}}
